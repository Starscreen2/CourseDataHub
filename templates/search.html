<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutgers Course Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/css/floating-planner.css?v=2">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="/static/script.js"></script>
    <script src="/static/js/course-planner.js"></script>
</head>
<body>
    <!-- Rutgers Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand text-outline" href="/">Rutgers Course Search</a>
            <div class="d-flex align-items-center">
                <a href="https://discord.gg/8GXTRWWYqb" class="discord-link" target="_blank">
                    <i class="bi bi-discord me-2"></i>Discord Sniper
                </a>
                <!-- Links Dropdown -->
                <div class="dropdown ms-3">
                    <a class="discord-link dropdown-toggle" href="#" role="button" id="linksDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-link-45deg me-2"></i>Links
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="linksDropdown">
                        <li><a class="dropdown-item" href="#" onclick="openPlanner(); return false;">Course Planner</a></li>
                        <li><a class="dropdown-item" href="https://rutgers-dining.vercel.app/" target="_blank">Meal Planner</a></li>
                        <li><a class="dropdown-item" href="https://scheduling.rutgers.edu/scheduling/academic-calendar" target="_blank">Academic Calendar</a></li>
                        <li><a class="dropdown-item" href="https://ibrahimmudassar.github.io/Rutgers-Salaries/" target="_blank">Rutgers Salaries</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="https://github.com/Starscreen2" target="_blank">Github</a></li>
                        <li><a class="dropdown-item" href="https://puyang.dev/" target="_blank">My Website</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-4">Search</h2>

        <div class="search-params mt-4">
            <p class="mb-1">
                <strong>Year:</strong> {{ year }}
                <strong class="ms-3">Term:</strong> 
                {% if term == '0' %}Winter
                {% elif term == '1' %}Spring
                {% elif term == '7' %}Summer
                {% elif term == '9' %}Fall
                {% endif %}
                <strong class="ms-3">Campus:</strong> 
                {% if campus == 'NB' %}New Brunswick
                {% elif campus == 'NK' %}Newark
                {% elif campus == 'CM' %}Camden
                {% endif %}
                <a href="/" class="btn btn-sm btn-outline-secondary float-end">Change</a>
            </p>
        </div>

        <!-- Main tabs -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link active" href="/search?year={{ year }}&term={{ term }}&campus={{ campus }}">Course Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/room-search?year={{ year }}&term={{ term }}&campus={{ campus }}">Room Search</a>
            </li>
        </ul>

        <!-- Filter Panel -->
        <div class="card mb-4">
            <div class="card-header">
                <button class="btn btn-link text-decoration-none w-100 text-start p-0" type="button" data-bs-toggle="collapse" data-bs-target="#filterPanel" aria-expanded="false" aria-controls="filterPanel">
                    <i class="bi bi-funnel me-2"></i>Filters
                    <i class="bi bi-chevron-down float-end" id="filterChevron"></i>
                </button>
            </div>
            <div class="collapse" id="filterPanel">
                <div class="card-body">
                    <div class="row">
                        <!-- Section Status -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">Section Status</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="statusOpen" checked>
                                <label class="form-check-label" for="statusOpen">Open</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="statusClosed" checked>
                                <label class="form-check-label" for="statusClosed">Closed</label>
                            </div>
                        </div>

                        <!-- Course Types -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">Course Types</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="typeTraditional">
                                <label class="form-check-label" for="typeTraditional">Traditional/Face-to-Face</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="typeHybrid">
                                <label class="form-check-label" for="typeHybrid">Hybrid</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="typeOnline">
                                <label class="form-check-label" for="typeOnline">Online & Remote Instruction</label>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        <!-- Campus Location -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">Campus Location</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campusCollegeAve">
                                <label class="form-check-label" for="campusCollegeAve">College Avenue</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campusBusch">
                                <label class="form-check-label" for="campusBusch">Busch</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campusLivingston">
                                <label class="form-check-label" for="campusLivingston">Livingston</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campusCookDoug">
                                <label class="form-check-label" for="campusCookDoug">C/D (Cook/Douglass)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campusOnline">
                                <label class="form-check-label" for="campusOnline">Online</label>
                            </div>
                        </div>

                        <!-- School/Unit -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">School/Unit</label>
                            <select class="form-select" id="schoolFilter">
                                <option value="">All Schools</option>
                                <option value="01">01 - School of Arts & Sciences</option>
                                <option value="03">03 - Military Science</option>
                                <option value="04">04 - School of Communication & Info (U)</option>
                                <option value="05">05 - Graduate School of Education (U)</option>
                                <option value="07">07 - Mason Gross School of the Arts (U)</option>
                                <option value="09">09 - School of Social Work (U)</option>
                                <option value="10">10 - Bloustein School of Planning (U)</option>
                                <option value="11">11 - School of Environmental & Biological Sci</option>
                                <option value="13">13 - Grad School of Applied & Prof Psych (U)</option>
                                <option value="14">14 - School of Engineering</option>
                                <option value="30">30 - Ernest Mario School of Pharmacy (U)</option>
                                <option value="33">33 - Rutgers Business School- NB campus (U)</option>
                                <option value="37">37 - School of Management & Labor Rel (U)</option>
                                <option value="77">77 - School of Nursing - New Brunswick (U)</option>
                            </select>
                        </div>

                        <!-- Core Codes -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">Core Code</label>
                            <select class="form-select" id="coreCodeFilter">
                                <option value="">All Core Codes</option>
                                <option value="CE">CE - Community Engagement</option>
                                <option value="AHo">AHo - Philosophical and Theoretical Issues</option>
                                <option value="AHp">AHp - Arts and Literatures</option>
                                <option value="AHq">AHq - Nature of Languages</option>
                                <option value="AHr">AHr - Critical Creative Expression</option>
                                <option value="CCD">CCD - Diversities and Social Inequalities</option>
                                <option value="CCO">CCO - Our Common Future</option>
                                <option value="HST">HST - Historical Analysis</option>
                                <option value="NS">NS - Natural Sciences</option>
                                <option value="QQ">QQ - Quantitative Information</option>
                                <option value="QR">QR - Mathematical or Formal Reasoning</option>
                                <option value="WC">WC - Writing and Communication</option>
                                <option value="WCr">WCr - Writing and Communication, Revision</option>
                                <option value="WCd">WCd - Writing and Communication in a Discipline</option>
                                <option value="ITR">ITR - Information Technology and Research</option>
                                <option value="SCL">SCL - Social Analysis</option>
                                <option value="ECN">ECN - Economic Analysis (SEBS Only)</option>
                                <option value="GVT">GVT - Government/Regulatory Analysis (SEBS Only)</option>
                                <option value="SOEHS">SOEHS - Approved Humanities/Social Science (SOE Only)</option>
                            </select>
                        </div>

                        <!-- Subject -->
                        <div class="col-md-6 col-lg-3 mb-3">
                            <label class="form-label fw-bold">Subject</label>
                            <select class="form-select" id="subjectFilter">
                                <option value="">All Subjects</option>
                                <option value="010">Accounting (010)</option>
                                <option value="011">Administrative Studies (011)</option>
                                <option value="013">African, Middle Eastern, and South Asian Languages and Literatures (013)</option>
                                <option value="014">Africana Studies (014)</option>
                                <option value="016">African Studies (016)</option>
                                <option value="020">Agriculture and Food Systems (020)</option>
                                <option value="035">Agricultural and Natural Resource Management (035)</option>
                                <option value="047">Alcohol Studies (047)</option>
                                <option value="050">American Studies (050)</option>
                                <option value="067">Animal Science (067)</option>
                                <option value="070">Anthropology (070)</option>
                                <option value="074">Arabic Languages (074)</option>
                                <option value="078">Armenian (078)</option>
                                <option value="080">Art (080)</option>
                                <option value="081">Art (081)</option>
                                <option value="082">Art History (082)</option>
                                <option value="090">Arts and Sciences (090)</option>
                                <option value="098">Asian Studies (098)</option>
                                <option value="115">Biochemistry (115)</option>
                                <option value="117">Bioenvironmental Engineering (117)</option>
                                <option value="119">Biological Sciences (119)</option>
                                <option value="122">Biomathematics (122)</option>
                                <option value="125">Biomedical Engineering (125)</option>
                                <option value="126">Biotechnology (126)</option>
                                <option value="136">Business Analytics and Information Technology (136)</option>
                                <option value="140">Business Law (140)</option>
                                <option value="146">Cell Biology and Neuroscience (146)</option>
                                <option value="155">Chemical and Biochemical Engineering (155)</option>
                                <option value="158">Chemical Biology (158)</option>
                                <option value="160">Chemistry (160)</option>
                                <option value="165">Chinese (165)</option>
                                <option value="175">Cinema Studies (175)</option>
                                <option value="180">Civil and Environmental Engineering (180)</option>
                                <option value="185">Cognitive Science (185)</option>
                                <option value="189">Communication and Media Studies (189)</option>
                                <option value="190">Classics (190)</option>
                                <option value="192">Communication (192)</option>
                                <option value="193">Community Health Outreach (193)</option>
                                <option value="195">Comparative Literature (195)</option>
                                <option value="198">Computer Science (198)</option>
                                <option value="202">Criminal Justice (202)</option>
                                <option value="203">Dance (203)</option>
                                <option value="206">Dance (206)</option>
                                <option value="207">Dance Education (207)</option>
                                <option value="211">Filmmaking (211)</option>
                                <option value="216">Ecology, Evolution and Natural Resources (216)</option>
                                <option value="219">Data Science (219)</option>
                                <option value="220">Economics (220)</option>
                                <option value="300">Education (300)</option>
                                <option value="332">Electrical and Computer Engineering (332)</option>
                                <option value="355">English - Composition and Writing (355)</option>
                                <option value="351">English - Creative Writing (351)</option>
                                <option value="354">English - Film Studies (354)</option>
                                <option value="356">English as a Second Language (356)</option>
                                <option value="358">English - Literature (358)</option>
                                <option value="359">English - Theories and Methods (359)</option>
                                <option value="360">European Studies (360)</option>
                                <option value="364">Educational Opportunity Fund (364)</option>
                                <option value="370">Entomology (370)</option>
                                <option value="373">Environmental and Business Economics (373)</option>
                                <option value="374">Environmental Policy, Institutions and Behavior (374)</option>
                                <option value="375">Environmental Sciences (375)</option>
                                <option value="377">Exercise Science (377)</option>
                                <option value="381">Environmental Studies (381)</option>
                                <option value="382">Entrepreneurship (382)</option>
                                <option value="390">Finance (390)</option>
                                <option value="400">Food Science (400)</option>
                                <option value="420">French (420)</option>
                                <option value="440">General Engineering (440)</option>
                                <option value="447">Genetics (447)</option>
                                <option value="450">Geography (450)</option>
                                <option value="460">Geological Sciences (460)</option>
                                <option value="470">German (470)</option>
                                <option value="489">Greek, Modern (489)</option>
                                <option value="490">Greek (490)</option>
                                <option value="501">Health Administration (501)</option>
                                <option value="505">Hindi (505)</option>
                                <option value="506">History - General/Comparative (506)</option>
                                <option value="508">History - Africa, Asia, Latin America (508)</option>
                                <option value="510">History (510)</option>
                                <option value="512">History - American (512)</option>
                                <option value="522">Ethics in Business Environment (522)</option>
                                <option value="533">Human Resource Management (533)</option>
                                <option value="535">Hungarian (535)</option>
                                <option value="540">Industrial and Systems Engineering (540)</option>
                                <option value="547">Information Technology and Informatics (547)</option>
                                <option value="550">Landscape Architecture (550)</option>
                                <option value="554">Interdisciplinary Studies (554)</option>
                                <option value="556">Interdisciplinary Studies - Arts and Sciences (556)</option>
                                <option value="557">Interdisciplinary - Mason Gross (557)</option>
                                <option value="558">International Studies (558)</option>
                                <option value="560">Italian (560)</option>
                                <option value="563">Jewish Studies (563)</option>
                                <option value="565">Japanese (565)</option>
                                <option value="567">Journalism and Media Studies (567)</option>
                                <option value="574">Korean (574)</option>
                                <option value="575">Labor Studies (575)</option>
                                <option value="580">Latin (580)</option>
                                <option value="590">Latin American Studies (590)</option>
                                <option value="595">Latino and Hispanic Caribbean Studies (595)</option>
                                <option value="607">Leadership Skills (607)</option>
                                <option value="615">Linguistics (615)</option>
                                <option value="617">Languages and Cultures (617)</option>
                                <option value="620">Management (620)</option>
                                <option value="624">Management and Work (624)</option>
                                <option value="628">Marine Sciences (628)</option>
                                <option value="630">Marketing (630)</option>
                                <option value="635">Materials Science and Engineering (635)</option>
                                <option value="640">Mathematics (640)</option>
                                <option value="650">Mechanical and Aerospace Engineering (650)</option>
                                <option value="652">Medical Ethics and Policy (652)</option>
                                <option value="667">Medieval Studies (667)</option>
                                <option value="670">Meteorology (670)</option>
                                <option value="680">Microbiology (680)</option>
                                <option value="685">Middle Eastern and Islamic Studies (685)</option>
                                <option value="690">Military Education, Air Force (690)</option>
                                <option value="691">Military Education, Army (691)</option>
                                <option value="692">Military Education, Navy (692)</option>
                                <option value="694">Molecular Biology and Biochemistry (694)</option>
                                <option value="700">Music (700)</option>
                                <option value="701">Music, Applied (701)</option>
                                <option value="705">Nursing (705)</option>
                                <option value="709">Nutritional Sciences (709)</option>
                                <option value="713">Organizational Leadership (713)</option>
                                <option value="715">Pharmaceutical Chemistry (715)</option>
                                <option value="718">Pharmacology, Cellular and Molecular (718)</option>
                                <option value="720">Pharmacy (720)</option>
                                <option value="721">Pharmaceutics (721)</option>
                                <option value="723">Persian (723)</option>
                                <option value="725">Pharmacy Practice and Administration (725)</option>
                                <option value="730">Philosophy (730)</option>
                                <option value="745">Physician Assistant (745)</option>
                                <option value="750">Physics (750)</option>
                                <option value="762">Planning and Public Policy (762)</option>
                                <option value="775">Policy, Health, and Administration (775)</option>
                                <option value="776">Plant Science (776)</option>
                                <option value="787">Polish (787)</option>
                                <option value="790">Political Science (790)</option>
                                <option value="799">Supply Chain and Marketing Science (799)</option>
                                <option value="810">Portuguese (810)</option>
                                <option value="830">Psychology (830)</option>
                                <option value="832">Public Health (832)</option>
                                <option value="833">Public Policy (833)</option>
                                <option value="840">Religion (840)</option>
                                <option value="843">Public Administration and Management (843)</option>
                                <option value="851">Real Estate (851)</option>
                                <option value="860">Russian (860)</option>
                                <option value="902">SEBS Internship (902)</option>
                                <option value="904">Social Justice (904)</option>
                                <option value="910">Social Work (910)</option>
                                <option value="920">Sociology (920)</option>
                                <option value="940">Spanish (940)</option>
                                <option value="955">Sport Management (955)</option>
                                <option value="959">Study Abroad (959)</option>
                                <option value="960">Statistics (960)</option>
                                <option value="965">Theater (965)</option>
                                <option value="966">Theater Arts (966)</option>
                                <option value="971">Urban Planning and Design (971)</option>
                                <option value="973">Turkish (973)</option>
                                <option value="975">Urban Studies and Community Development (975)</option>
                                <option value="988">Women's, Gender, and Sexuality Studies (988)</option>
                                <option value="991">World Languages (991)</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-secondary" id="clearFilters">Clear Filters</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="search-form">
            <form id="searchForm">
                <div class="form-group">
                    <input type="text" class="form-control" id="search" placeholder="Search courses (e.g., CS 111, Intro to Computer Science)">
                    <div class="d-flex gap-2 mt-3 flex-wrap align-items-center">
                        <button type="submit" class="btn btn-primary">Search Courses</button>
                        <!-- People Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="peopleDropdownButton" data-bs-toggle="dropdown" aria-expanded="false">
                                People
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="peopleDropdownButton" id="peopleDropdownMenu" style="max-height: 320px; overflow-y: auto; min-width: 22rem;">
                                <!-- dynamically populated -->
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        

        <!-- Loading spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Searching courses...</p>
        </div>

        <div class="results" id="results"></div>
    </div>

    <!-- Floating Course Planner Button -->
    <div id="floatingPlanner" class="floating-planner">
        <div class="floating-button-container">
            <!-- Course count badge -->
            <div id="courseCountBadge" class="course-count-badge" style="display: none;">
                <span id="courseCount">0</span>
            </div>
            
            <!-- Main floating button -->
            <button id="plannerButton" class="floating-button" onclick="togglePlanner()">
                <i class="bi bi-calendar3"></i>
                <span class="button-text">Planner</span>
            </button>
            
            <!-- Tooltip -->
            <div class="floating-tooltip">
                <span id="tooltipText">Open Calendar</span>
                <div class="tooltip-arrow"></div>
            </div>
        </div>
    </div>

    <!-- Course Planner Popup -->
    <div id="plannerPopup" class="planner-popup">
        <div class="planner-backdrop" onclick="closePlanner()"></div>
        <div class="planner-content">
            <!-- Header -->
            <div class="planner-header">
                <div class="planner-title">
                    <h1>Rutgers Course Planner</h1>
                    <p>Plan and visualize your class schedule</p>
                </div>
                <div class="planner-actions">
                    <button class="btn btn-primary" onclick="closePlanner()">
                        <i class="bi bi-search me-1"></i>Search Classes
                    </button>
                    <button class="btn btn-close" onclick="closePlanner()"></button>
                </div>
            </div>

            <!-- Controls -->
            <div class="planner-controls">
                <div class="schedule-info">
                    <span id="plannerSubtitle">0 courses in schedule</span>
                </div>
                <div class="controls-right">
                    <div class="view-toggle">
                        <button class="view-btn active" id="calendarViewBtn" onclick="switchView('calendar')">
                            <i class="bi bi-calendar3 me-1"></i>Calendar View
                        </button>
                        <button class="view-btn" id="listViewBtn" onclick="switchView('list')">
                            <i class="bi bi-list me-1"></i>List View
                        </button>
                    </div>
                    <button class="btn btn-outline-secondary btn-sm" onclick="exportSchedule()">
                        <i class="bi bi-download me-1"></i>Export
                    </button>
                </div>
            </div>

            <!-- Campus Colors Legend -->
            <div class="campus-legend">
                <span class="legend-label">Campus Colors:</span>
                <div class="campus-colors">
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #dc3545;"></div>
                        <span>College Ave</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #0d6efd;"></div>
                        <span>Busch</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #198754;"></div>
                        <span>Livingston</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #fd7e14;"></div>
                        <span>Cook/Douglass</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #6f42c1;"></div>
                        <span>Online</span>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="planner-body">
                <div class="planner-main">
                    <!-- Calendar View -->
                    <div id="calendarView" class="calendar-view">
                        <div class="weekly-calendar">
                            <div class="calendar-header">
                                <div class="time-column"></div>
                                <div class="day-header">Monday</div>
                                <div class="day-header">Tuesday</div>
                                <div class="day-header">Wednesday</div>
                                <div class="day-header">Thursday</div>
                                <div class="day-header">Friday</div>
                            </div>
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- Time slots will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- List View -->
                    <div id="listView" class="list-view" style="display: none;">
                        <div id="emptyState" class="empty-state">
                            <div class="empty-icon">
                                <i class="bi bi-book"></i>
                            </div>
                            <h3>No courses scheduled</h3>
                            <p>Start building your schedule by searching for courses and adding them to your planner.</p>
                            <button class="btn btn-primary" onclick="closePlanner()">
                                <i class="bi bi-search me-2"></i>Search Courses
                            </button>
                        </div>

                        <div id="courseList" class="course-list" style="display: none;">
                            <div id="scheduledCoursesList" class="courses-grid">
                                <!-- Courses will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <aside id="plannerDetailPanel" class="detail-panel" aria-hidden="true">
                    <div class="detail-panel-header">
                        <div class="detail-panel-header-left">
                            <button type="button" class="detail-panel-back" aria-label="Back to course details">
                                <i class="bi bi-arrow-left"></i>
                            </button>
                            <div class="detail-panel-text">
                                <h2 class="detail-panel-title">Course Details</h2>
                                <p class="detail-panel-subtitle">Select a course to view full information</p>
                            </div>
                        </div>
                        <button type="button" class="btn-close detail-panel-close" aria-label="Close details"></button>
                    </div>
                    <div class="detail-panel-body">
                        <div class="detail-panel-empty">Select a course on the calendar or list to see details here.</div>
                    </div>
                </aside>
            </div>

            <!-- Footer -->
            <div class="planner-footer" data-year="{{ year }}" data-term="{{ term }}">
                <button class="btn btn-primary" onclick="openWebReg()">
                    <i class="bi bi-calendar-check me-1"></i>Register in WebReg
                </button>
                <button class="btn btn-outline-secondary" onclick="copyScheduleLink()">
                    <i class="bi bi-link-45deg me-1"></i>Copy Link
                </button>
                <button class="btn btn-outline-danger" onclick="clearSchedule()">
                    <i class="bi bi-trash me-1"></i>Clear Calendar
                </button>
            </div>
        </div>
    </div>

    <script>
        async function loadSalaries() {
            try {
                const response = await fetch('/static/rutgers_salaries.json');
                const salaryJson = await response.json();
                return salaryJson.data;
            } catch (error) {
                console.error("Failed to load data:", error);
                return [];
            }
        }

        // Filter chevron toggle
        const filterPanel = document.getElementById('filterPanel');
        const filterChevron = document.getElementById('filterChevron');
        if (filterPanel && filterChevron) {
            filterPanel.addEventListener('show.bs.collapse', function() {
                filterChevron.classList.remove('bi-chevron-down');
                filterChevron.classList.add('bi-chevron-up');
            });
            filterPanel.addEventListener('hide.bs.collapse', function() {
                filterChevron.classList.remove('bi-chevron-up');
                filterChevron.classList.add('bi-chevron-down');
            });
        }

        // Clear filters button
        document.getElementById('clearFilters').addEventListener('click', function() {
            // Reset all checkboxes
            document.getElementById('statusOpen').checked = true;
            document.getElementById('statusClosed').checked = true;
            document.getElementById('typeTraditional').checked = false;
            document.getElementById('typeHybrid').checked = false;
            document.getElementById('typeOnline').checked = false;
            document.getElementById('campusCollegeAve').checked = false;
            document.getElementById('campusBusch').checked = false;
            document.getElementById('campusLivingston').checked = false;
            document.getElementById('campusCookDoug').checked = false;
            document.getElementById('campusOnline').checked = false;
            document.getElementById('schoolFilter').value = '';
            document.getElementById('coreCodeFilter').value = '';
            document.getElementById('subjectFilter').value = '';
        });

        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const search = document.getElementById('search').value;
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultsDiv = document.getElementById('results');

            loadingSpinner.style.display = 'block';
            resultsDiv.innerHTML = '';

            // Collect filter values
            const params = new URLSearchParams({
                year: '{{ year }}',
                term: '{{ term }}',
                campus: '{{ campus }}',
                search: search
            });

            // Add status filters
            if (document.getElementById('statusOpen').checked) {
                params.append('status_open', 'true');
            }
            if (document.getElementById('statusClosed').checked) {
                params.append('status_closed', 'true');
            }

            // Add course type filters
            if (document.getElementById('typeTraditional').checked) {
                params.append('type_traditional', 'true');
            }
            if (document.getElementById('typeHybrid').checked) {
                params.append('type_hybrid', 'true');
            }
            if (document.getElementById('typeOnline').checked) {
                params.append('type_online', 'true');
            }


            // Add campus filters
            if (document.getElementById('campusCollegeAve').checked) {
                params.append('campus_college_ave', 'true');
            }
            if (document.getElementById('campusBusch').checked) {
                params.append('campus_busch', 'true');
            }
            if (document.getElementById('campusLivingston').checked) {
                params.append('campus_livingston', 'true');
            }
            if (document.getElementById('campusCookDoug').checked) {
                params.append('campus_cook_doug', 'true');
            }
            if (document.getElementById('campusOnline').checked) {
                params.append('campus_online', 'true');
            }

            // Add school filter
            const schoolFilter = document.getElementById('schoolFilter').value;
            if (schoolFilter) {
                params.append('school', schoolFilter);
            }

            // Add core code filter
            const coreCodeFilter = document.getElementById('coreCodeFilter').value;
            if (coreCodeFilter) {
                params.append('core_code', coreCodeFilter);
            }

            // Add subject filter
            const subjectFilter = document.getElementById('subjectFilter').value;
            if (subjectFilter) {
                params.append('subject', subjectFilter);
            }

            try {
                const response = await fetch(`/api/courses?${params}`);
                const data = await response.json();

                loadingSpinner.style.display = 'none';

                if (data.status === 'success' && data.data.length > 0) {
                    resultsDiv.innerHTML = data.data.map((course, courseIndex) => `
                        <div class="search-result-item card mb-4">
                            <div class="card-header">
                                <h4 class="mb-0">${course.courseString} - ${course.title}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <p><strong>Subject:</strong> ${course.subject} - ${course.subjectDescription}</p>
                                        <p><strong>Credits:</strong> ${course.creditsDescription || course.credits}</p>
                                        <p><strong>School:</strong> ${course.school || 'N/A'}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Campus Locations:</strong> ${course.campusLocations.join(', ') || 'N/A'}</p>
                                        <p><strong>Prerequisites:</strong> ${course.prerequisites || 'None'}</p>
                                        <p><strong>Core Codes:</strong> ${Array.isArray(course.coreRequirements) && course.coreRequirements.length > 0 ? 
                                            course.coreRequirements.map(core => `${core.code} (${core.description})`).join(', ') : 'N/A'}</p>
                                    </div>
                                </div>

                                <div class="sections">
                                    <button class="btn btn-primary mb-3" type="button" 
                                            data-bs-toggle="collapse" 
                                            data-bs-target="#sections-${courseIndex}" 
                                            aria-expanded="false" 
                                            aria-controls="sections-${courseIndex}">
                                        Show/Hide ${course.sections.length} Sections
                                    </button>
                                    <div class="collapse" id="sections-${courseIndex}">
                                        ${course.sections.map(section => `
                                            <div class="section-item card mb-3">
                                                <div class="card-body">
                                                    <h6>Section ${section.number} (Index: ${section.index} <button class="copy-button" onclick="copyToClipboard('${section.index}')" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy index number"><i class="bi bi-clipboard"></i></button>)</h6>
                                                    <p><strong>Instructors:</strong> 
                                                        ${section.instructors.map(instructor => `
                                                            <span class="instructor-name" 
                                                                  data-bs-toggle="tooltip" 
                                                                  data-bs-placement="top" 
                                                                  title="Loading data...">
                                                                  ${instructor}
                                                            </span>`).join(', ') || 'TBA'}
                                                    </p>
                                                    <p><strong>Status:</strong> <span class="${section.status.toLowerCase() === 'open' ? 'status-open' : 'status-closed'}">${section.status}</span></p>
                                                    <div class="meeting-times">
                                                        <strong>Meeting Times:</strong><br>
                                                        ${section.meeting_times.map(time => `
                                                            <p>
                                                                ${time.day || 'TBA'} 
                                                                ${time.start_time.formatted} - ${time.end_time.formatted}<br>
                                                                Location: ${time.building} ${time.room}<br>
                                                                Campus: ${time.campus}<br>
                                                                Mode: ${time.mode}
                                                            </p>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                    tooltipTriggerList.forEach(tooltipEl => new bootstrap.Tooltip(tooltipEl));
                    
                    // Add planner buttons after rendering (without interfering with existing functionality)
                    setTimeout(addPlannerButtons, 100);
                    setTimeout(addPlannerButtons, 500); // Second attempt
                    setTimeout(addPlannerButtons, 1000); // Third attempt
                    
                    // Also add buttons when sections are expanded
                    const collapseButtons = document.querySelectorAll('[data-bs-toggle="collapse"]');
                    collapseButtons.forEach(button => {
                        button.addEventListener('shown.bs.collapse', function() {
                            setTimeout(addPlannerButtons, 50);
                        });
                    });
                } else {
                    resultsDiv.innerHTML = '<div class="alert alert-info">No courses found</div>';
                }
            } catch (error) {
                loadingSpinner.style.display = 'none';
                console.error('Error searching courses:', error);
                resultsDiv.innerHTML = '<div class="alert alert-danger">Error searching courses</div>';
            }
        });

        // Floating Course Planner JavaScript
        // Global variables and initialization are now handled in course-planner.js

        // Initialize planner on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePlannerUI();
            showFloatingButton();
            
            // Set up observer to watch for new sections being added
            setupSectionObserver();
        });

        function setupSectionObserver() {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv) return;

            // Create a MutationObserver to watch for new sections
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        // Check if any new section items were added
                        const addedNodes = Array.from(mutation.addedNodes);
                        const hasNewSections = addedNodes.some(node => 
                            node.nodeType === Node.ELEMENT_NODE && 
                            (node.classList?.contains('section-item') || 
                             node.querySelector?.('.section-item'))
                        );
                        
                        if (hasNewSections) {
                            setTimeout(addPlannerButtons, 100);
                        }
                    }
                });
            });

            // Start observing
            observer.observe(resultsDiv, {
                childList: true,
                subtree: true
            });
        }

        // showFloatingButton() is now in course-planner.js

        // togglePlanner(), openPlanner(), closePlanner(), and openCoursePlanner() are now in course-planner.js

        // exportSchedule() is now in course-planner.js

        // switchView() and generateCalendarGrid() are now in course-planner.js

        // addCoursesToCalendar() is now in course-planner.js

        // copyScheduleLink() and clearSchedule() are now in course-planner.js

        // updatePlannerUI() is now in course-planner.js

        // updateCourseList() is now in course-planner.js

        // updateStats() is now in course-planner.js

        // addCourseToPlanner() is now in course-planner.js

        // removeCourse() is now in course-planner.js

        // showNotification() is now in course-planner.js

        // Add "Add to Planner" buttons to each section
        function addPlannerButtons() {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv) return;
            
            // Find all section items, including those in collapsed sections
            const sectionCards = resultsDiv.querySelectorAll('.section-item');
            
            console.log(`Found ${sectionCards.length} section cards to process`);
            
            sectionCards.forEach((sectionCard, index) => {
                const existingButton = sectionCard.querySelector('.add-to-planner-btn');
                
                if (!existingButton) {
                    console.log(`Adding button to section ${index + 1}`);
                    const addButton = document.createElement('button');
                    addButton.className = 'btn btn-outline-primary add-to-planner-btn mt-2';
                    addButton.innerHTML = '<i class="bi bi-plus-circle me-1"></i>Add to Planner';
                    addButton.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        try {
                            // Extract course data from the parent course card
                            const courseCard = sectionCard.closest('.search-result-item');
                            if (!courseCard) {
                                console.error('Course card not found');
                                return;
                            }
                            
                            const courseTitle = courseCard.querySelector('h4');
                            if (!courseTitle) {
                                console.error('Course title not found');
                                return;
                            }
                            
                            const titleParts = courseTitle.textContent.split(' - ');
                            const courseString = titleParts[0] || '';
                            const title = titleParts[1] || '';
                            
                            console.log('Course string:', courseString, 'Title:', title);
                            
                            // Extract course details more safely
                            const courseDetails = courseCard.querySelectorAll('.col-md-6 p');
                            let subject = '', credits = '', school = '';
                            
                            courseDetails.forEach(p => {
                                const text = p.textContent;
                                if (text.includes('Subject:')) {
                                    subject = text.replace('Subject:', '').trim();
                                } else if (text.includes('Credits:')) {
                                    credits = text.replace('Credits:', '').trim();
                                } else if (text.includes('School:')) {
                                    school = text.replace('School:', '').trim();
                                }
                            });
                            
                            // Extract section data
                            const sectionHeader = sectionCard.querySelector('h6');
                            if (!sectionHeader) {
                                console.error('Section header not found');
                                return;
                            }
                            
                            const sectionText = sectionHeader.textContent;
                            const sectionNumber = sectionText.match(/Section (\d+)/)?.[1] || '';
                            const sectionIndex = sectionText.match(/Index: (\d+)/)?.[1] || '';
                            
                            console.log('Section number:', sectionNumber, 'Index:', sectionIndex);
                            
                            // Extract status
                            const statusElement = sectionCard.querySelector('.status-open, .status-closed');
                            const status = statusElement ? statusElement.textContent : 'Unknown';
                            
                            // Extract instructors
                            const instructorElements = sectionCard.querySelectorAll('.instructor-name');
                            const instructors = Array.from(instructorElements).map(el => el.textContent.trim()).filter(Boolean);
                            
                            // Extract meeting times
                            const meetingTimes = [];
                            const meetingTimeElements = sectionCard.querySelectorAll('.meeting-times p');
                            meetingTimeElements.forEach(timeEl => {
                                const text = timeEl.textContent;
                                const dayMatch = text.match(/(\w+)/);
                                const timeMatch = text.match(/(\d{1,2}:\d{2} [AP]M) - (\d{1,2}:\d{2} [AP]M)/);
                                const locationMatch = text.match(/Location: ([^C]+)/);
                                const campusMatch = text.match(/Campus: ([^M]+)/);
                                
                                if (dayMatch && timeMatch) {
                                    meetingTimes.push({
                                        day: dayMatch[1],
                                        startTime: { formatted: timeMatch[1] },
                                        endTime: { formatted: timeMatch[2] },
                                        building: locationMatch ? locationMatch[1].trim() : '',
                                        campus: campusMatch ? campusMatch[1].trim() : ''
                                    });
                                }
                            });
                            
                            console.log('Meeting times:', meetingTimes);
                            
                            const course = {
                                courseString: courseString,
                                title: title,
                                subject: subject,
                                credits: credits,
                                school: school,
                                campusLocations: [],
                                selectedSection: {
                                    number: sectionNumber,
                                    index: sectionIndex,
                                    status: status,
                                    instructors: instructors.length > 0 ? instructors : ['TBA'],
                                    meetingTimes: meetingTimes
                                }
                            };
                            
                            console.log('Course object:', course);
                            addCourseToPlanner(course);
                        } catch (error) {
                            console.error('Error adding course to planner:', error);
                            showNotification('Error adding course to planner: ' + error.message, 'danger');
                        }
                    };
                    
                    // Add button to the section card body
                    const sectionBody = sectionCard.querySelector('.card-body');
                    if (sectionBody) {
                        sectionBody.appendChild(addButton);
                        console.log(`Button added to section ${index + 1}`);
                    } else {
                        console.log(`No card-body found for section ${index + 1}`);
                    }
                } else {
                    console.log(`Button already exists for section ${index + 1}`);
                }
            });
        }

        // Manual function to trigger button addition (can be called from console for debugging)
        function forceAddPlannerButtons() {
            console.log('Force adding planner buttons...');
            addPlannerButtons();
        }

        // Keep the original search functionality intact and just add planner buttons
        // The original search form handler is already defined above, so we just need to add planner buttons after results are loaded

        // Close planner when clicking outside
        document.addEventListener('click', function(e) {
            const plannerPopup = document.getElementById('plannerPopup');
            const floatingPlanner = document.getElementById('floatingPlanner');
            
            if (isPlannerOpen && !plannerPopup.contains(e.target) && !floatingPlanner.contains(e.target)) {
                closePlanner();
            }
        });

        // Close planner with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isPlannerOpen) {
                closePlanner();
            }
        });

        // Global event listener for any collapse being shown
        document.addEventListener('shown.bs.collapse', function(e) {
            // Check if this is a sections collapse
            if (e.target.id && e.target.id.startsWith('sections-')) {
                setTimeout(addPlannerButtons, 100);
            }
        });
    </script>
</body>
</html>
