<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutgers Course Search - Select Parameters</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/css/floating-planner.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/course-planner.js"></script>
    
</head>
<body>
    <!-- Add Rutgers Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand text-outline" href="/">Rutgers Course Search</a>
            <div class="d-flex align-items-center">
                <!-- <a href="https://discord.gg/8GXTRWWYqb" class="discord-link" target="_blank">
                    <i class="bi bi-discord me-2"></i>Discord Sniper
                </a> -->
                <!-- Links Dropdown -->
                <div class="dropdown ms-3">
                    <a class="discord-link dropdown-toggle" href="#" role="button" id="linksDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-link-45deg me-2"></i>Links
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="linksDropdown">
                        <li><a class="dropdown-item" href="https://rutgers-dining.vercel.app/" target="_blank">Meal Planner</a></li>
                        <li><a class="dropdown-item" href="https://scheduling.rutgers.edu/scheduling/academic-calendar" target="_blank">Academic Calendar</a></li>
                        <li><a class="dropdown-item" href="https://ibrahimmudassar.github.io/Rutgers-Salaries/" target="_blank">Rutgers Salaries</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="https://github.com/Starscreen2" target="_blank">Github</a></li>
                        <li><a class="dropdown-item" href="https://puyang.dev/" target="_blank">My Website</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-4">Select Parameters</h2>
        <form id="paramForm">
            <div class="form-group mb-3">
                <label for="year">Year:</label>
                <select class="form-control" id="year" name="year" required>
                    <option value="">Select a Year</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                </select>
            </div>
            <div class="form-group mb-3">
                <label for="term">Term:</label>
                <select class="form-control" id="term" name="term" required>
                    <option value="">Select a Term</option>
                    <option value="0">Winter</option>
                    <option value="1" selected>Spring</option>
                    <option value="7">Summer</option>
                    <option value="9">Fall</option>
                </select>
            </div>
            <div class="form-group mb-3">
                <label for="campus">Campus:</label>
                <select class="form-control" id="campus" name="campus" required>
                    <option value="">Select a Campus</option>
                    <option value="NB" selected>New Brunswick</option>
                    <option value="NK">Newark</option>
                    <option value="CM">Camden</option>
                </select>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <button type="button" id="courseSearchBtn" class="btn btn-primary w-100">
                        <i class="bi bi-book"></i> Continue to Course Search
                    </button>
                </div>
                <div class="col-md-6 mb-3">
                    <button type="button" id="roomSearchBtn" class="btn btn-primary w-100">
                        <i class="bi bi-building"></i> Continue to Room Search
                    </button>
                </div>
            </div>
        </form>
        
        <script>
            document.getElementById('courseSearchBtn').addEventListener('click', function() {
                const year = document.getElementById('year').value;
                const term = document.getElementById('term').value;
                const campus = document.getElementById('campus').value;
                
                if (year && term && campus) {
                    window.location.href = `/search?year=${year}&term=${term}&campus=${campus}`;
                } else {
                    alert('Please select all parameters');
                }
            });
            
            document.getElementById('roomSearchBtn').addEventListener('click', function() {
                const year = document.getElementById('year').value;
                const term = document.getElementById('term').value;
                const campus = document.getElementById('campus').value;
                
                if (year && term && campus) {
                    window.location.href = `/room-search?year=${year}&term=${term}&campus=${campus}`;
                } else {
                    alert('Please select all parameters');
                }
            });
        </script>
    </div>

    <!-- Floating Course Planner Button -->
    <div id="floatingPlanner" class="floating-planner">
        <div class="floating-button-container">
            <!-- Course count badge -->
            <div id="courseCountBadge" class="course-count-badge" style="display: none;">
                <span id="courseCount">0</span>
            </div>
            
            <!-- Main floating button -->
            <button id="plannerButton" class="floating-button" onclick="togglePlanner()">
                <i class="bi bi-calendar3"></i>
                <span class="button-text">Planner</span>
            </button>
            
            <!-- Tooltip -->
            <div class="floating-tooltip">
                <span id="tooltipText">Open Calendar</span>
                <div class="tooltip-arrow"></div>
            </div>
        </div>
    </div>

    <!-- Course Planner Popup -->
    <div id="plannerPopup" class="planner-popup">
        <div class="planner-backdrop" onclick="closePlanner()"></div>
        <div class="planner-content">
            <!-- Header -->
            <div class="planner-header">
                <div class="planner-title">
                    <h1>Rutgers Course Planner</h1>
                    <p>Plan and visualize your class schedule</p>
                </div>
                <div class="planner-actions">
                    <button class="btn btn-primary" onclick="closePlanner()">
                        <i class="bi bi-search me-1"></i>Search Classes
                    </button>
                    <button class="btn btn-close" onclick="closePlanner()"></button>
                </div>
            </div>

            <!-- Controls -->
            <div class="planner-controls">
                <div class="schedule-info">
                    <span id="plannerSubtitle">0 courses in schedule</span>
                </div>
                <div class="controls-right">
                    <div class="view-toggle">
                        <button class="view-btn active" id="calendarViewBtn" onclick="switchView('calendar')">
                            <i class="bi bi-calendar3 me-1"></i>Calendar View
                        </button>
                        <button class="view-btn" id="listViewBtn" onclick="switchView('list')">
                            <i class="bi bi-list me-1"></i>List View
                        </button>
                    </div>
                    <button class="btn btn-outline-secondary btn-sm" onclick="exportSchedule()">
                        <i class="bi bi-download me-1"></i>Export
                    </button>
                </div>
            </div>

            <!-- Campus Colors Legend -->
            <div class="campus-legend">
                <span class="legend-label">Campus Colors:</span>
                <div class="campus-colors">
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #dc3545;"></div>
                        <span>College Ave</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #0d6efd;"></div>
                        <span>Busch</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #198754;"></div>
                        <span>Livingston</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #fd7e14;"></div>
                        <span>Cook/Douglass</span>
                    </div>
                    <div class="campus-color-item">
                        <div class="color-dot" style="background-color: #6f42c1;"></div>
                        <span>Online</span>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="planner-body">
                <div class="planner-main">
                    <!-- Calendar View -->
                    <div id="calendarView" class="calendar-view">
                        <div class="weekly-calendar">
                            <div class="calendar-header">
                                <div class="time-column"></div>
                                <div class="day-header">Monday</div>
                                <div class="day-header">Tuesday</div>
                                <div class="day-header">Wednesday</div>
                                <div class="day-header">Thursday</div>
                                <div class="day-header">Friday</div>
                            </div>
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- Time slots will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- List View -->
                    <div id="listView" class="list-view" style="display: none;">
                        <div id="emptyState" class="empty-state">
                            <div class="empty-icon">
                                <i class="bi bi-book"></i>
                            </div>
                            <h3>No courses scheduled</h3>
                            <p>Start building your schedule by searching for courses and adding them to your planner.</p>
                            <button class="btn btn-primary" onclick="closePlanner()">
                                <i class="bi bi-search me-2"></i>Search Courses
                            </button>
                        </div>

                        <div id="courseList" class="course-list" style="display: none;">
                            <div id="scheduledCoursesList" class="courses-grid">
                                <!-- Courses will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <aside id="plannerDetailPanel" class="detail-panel" aria-hidden="true">
                    <div class="detail-panel-header">
                        <div class="detail-panel-header-left">
                            <button type="button" class="detail-panel-back" aria-label="Back to course details">
                                <i class="bi bi-arrow-left"></i>
                            </button>
                            <div class="detail-panel-text">
                                <h2 class="detail-panel-title">Course Details</h2>
                                <p class="detail-panel-subtitle">Select a course to view full information</p>
                            </div>
                        </div>
                        <button type="button" class="btn-close detail-panel-close" aria-label="Close details"></button>
                    </div>
                    <div class="detail-panel-body">
                        <div class="detail-panel-empty">Select a course on the calendar or list to see details here.</div>
                    </div>
                </aside>
            </div>

            <!-- Footer -->
            <div class="planner-footer">
                <button class="btn btn-primary" onclick="openWebReg()">
                    <i class="bi bi-calendar-check me-1"></i>Register in WebReg
                </button>
                <button class="btn btn-outline-secondary" onclick="copyScheduleLink()">
                    <i class="bi bi-link-45deg me-1"></i>Copy Link
                </button>
                <button class="btn btn-outline-danger" onclick="clearSchedule()">
                    <i class="bi bi-trash me-1"></i>Clear Calendar
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center mt-5 p-3 bg-dark text-light">
        <p class="mb-0"><a href="https://v0-course-data-hub-3o.vercel.app/" class="text-light" target="_blank">How this site was made</a></p>
    </footer>

    <script>
        // Floating Course Planner JavaScript
        // Global variables and initialization are now handled in course-planner.js

        // Initialize planner on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePlannerUI();
            showFloatingButton();
        });

        // showFloatingButton(), togglePlanner(), openPlanner(), closePlanner(), and openCoursePlanner() are now in course-planner.js

        // exportSchedule() is now in course-planner.js

        // All remaining course planner functions are now in course-planner.js

        // Close planner when clicking outside
        document.addEventListener('click', function(e) {
            const plannerPopup = document.getElementById('plannerPopup');
            const floatingPlanner = document.getElementById('floatingPlanner');
            
            if (isPlannerOpen && !plannerPopup.contains(e.target) && !floatingPlanner.contains(e.target)) {
                closePlanner();
            }
        });

        // Close planner with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isPlannerOpen) {
                closePlanner();
            }
        });
    </script>
    
</body>
</html>
